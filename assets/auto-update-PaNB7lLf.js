let c;const i=/<script[^>]*src\s*=\s*["'](?<src>[^"']*)["'][^>]*>/gi;async function d(){const{origin:o,pathname:e}=window.location,t=o+e,l=await fetch(t+"?_timestamp="+Date.now()).then(a=>a.text());console.log(l,"html"),i.lastIndex=0;let s=[],n;for(;n=i.exec(l);)s.push(n.groups.src);return s}async function p(){const o=await d();if(console.log(o,"newScripts"),console.log(c,"lastSrcs"),!c)return c=o,!1;let e=!1;c.length!==o.length&&(e=!0);for(let t=0;t<c.length;t++)if(c[t]!==o[t]){e=!0;break}return c=o,e}function u(){return new Promise(o=>{const e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgba(0, 0, 0, 0.5)",e.style.zIndex="9999";const t=document.createElement("div");t.style.backgroundColor="#fff",t.style.paddingBottom="16px",t.style.borderRadius="5px",t.style.textAlign="center",t.style.margin="10% auto auto",t.style.width="35%";const l=document.createElement("div");l.textContent="页面已更新",l.style.color="#303133",l.style.fontSize="16px",l.style.textAlign="left",l.style.borderBottom="1px solid #ccc",l.style.padding="10px";const s=document.createElement("p");s.style.fontSize="14px",s.style.margin="16px",s.style.color="#606266",s.textContent="页面脚本已更新，请点击确定获取最新版本。";const n=document.createElement("button");n.textContent="确定",n.style.fontSize="14px",n.style.padding="5px 25px",n.style.backgroundColor="#007bff",n.style.color="#fff",n.style.border="none",n.style.borderRadius="3px",n.style.cursor="pointer",n.addEventListener("click",()=>{document.body.removeChild(e),o()}),t.appendChild(l),t.appendChild(s),t.appendChild(n),e.appendChild(t),document.body.appendChild(e)})}const y=2e3;function r(){setTimeout(async()=>{await p()&&(await u(),location.reload()),r()},y)}r();
